<?php
$count = 0;
// display errors or not...

$link = pg_connect("host=orbis-prod.stanford.edu dbname=kindred user=webapp password=sl1ppy");

$indiv_array = array(2491,
2481,
1284,
1298,
1269,
2248,
2263,
2278,
26969,
3601,
2346,
1807,
2373,
2774,
18250,
2777,
2367,
3757,
1797,
27325,
26992,
17762,
6724,
17652,
3587,
28327,
2967,
27278,
4399,
2963,
4424,
28149,
1787,
3012,
15189,
8803,
4918,
3554,
6679,
4437,
1339,
9982,
6719,
7901,
1735,
10477,
6842,
1668,
14576,
5382,
26116,
7493,
27495,
5906,
5457,
23668,
26113,
7999,
9190,
26218,
10762,
1511,
3904,
18743,
17628,
8838,
6877,
27821,
17777,
23697,
1889,
18667,
1952,
4983,
9417,
6163,
25664,
19233,
5804,
7619,
2007,
28778,
24214,
9287,
21391,
75,
27735,
12433,
8310,
25056,
12438,
12432,
4334,
4852,
16880,
4369,
4994,
17347,
8346,
26731,
957,
10834,
17428,
24963,
7462,
9997,
12922,
12220,
7733,
12144,
25819,
7677,
14707,
3920,
14698,
3509,
8284,
7570,
28856,
16725,
9524,
20490,
22141,
15627,
6072,
10986,
10536,
22851,
2053,
10034,
29012,
6525,
26810,
13890,
6782,
29464,
28590,
19924,
10864,
3929,
12718,
10769,
19857,
25981,
9152,
10054,
7651,
10306,
2135,
9669,
20562,
8,
9394,
30264,
7674,
6740,
29036,
30169,
23160,
29977,
5821,
28692,
10701,
8068,
6331,
6142,
27715,
16289,
662,
21063,
23880,
15645,
22760,
22758,
6270,
5,
23175,
15361,
6431,
10088,
2105,
13636,
23111,
29102,
6268,
6512,
9110,
27868,
1976,
9048);

foreach($indiv_array as $iid){
$sql = "
SELECT fullname, indiv_id, cost FROM KDijkstra_dist_sp
     ('
     SELECT
recno as id,
(substr(source, 2, length(source) - 1))::integer as source,
(substr(target, 2, length(target) - 1))::integer as target,
1::double precision as cost

         FROM edges',
         ".$iid.", '{
2491,
2481,
1284,
1298,
1269,
2248,
2263,
2278,
26969,
3601,
2346,
1807,
2373,
2774,
18250,
2777,
2367,
3757,
1797,
27325,
26992,
17762,
6724,
17652,
3587,
28327,
2967,
27278,
4399,
2963,
4424,
28149,
1787,
3012,
15189,
8803,
4918,
3554,
6679,
4437,
1339,
9982,
6719,
7901,
1735,
10477,
6842,
1668,
14576,
5382,
26116,
7493,
27495,
5906,
5457,
23668,
26113,
7999,
9190,
26218,
10762,
1511,
3904,
18743,
17628,
8838,
6877,
27821,
17777,
23697,
1889,
18667,
1952,
4983,
9417,
6163,
25664,
19233,
5804,
7619,
2007,
28778,
24214,
9287,
21391,
75,
27735,
12433,
8310,
25056,
12438,
12432,
4334,
4852,
16880,
4369,
4994,
17347,
8346,
26731,
957,
10834,
17428,
24963,
7462,
9997,
12922,
12220,
7733,
12144,
25819,
7677,
14707,
3920,
14698,
3509,
8284,
7570,
28856,
16725,
9524,
20490,
22141,
15627,
6072,
10986,
10536,
22851,
2053,
10034,
29012,
6525,
26810,
13890,
6782,
29464,
28590,
19924,
10864,
3929,
12718,
10769,
19857,
25981,
9152,
10054,
7651,
10306,
2135,
9669,
20562,
8,
9394,
30264,
7674,
6740,
29036,
30169,
23160,
29977,
5821,
28692,
10701,
8068,
6331,
6142,
27715,
16289,
662,
21063,
23880,
15645,
22760,
22758,
6270,
5,
23175,
15361,
6431,
10088,
2105,
13636,
23111,
29102,
6268,
6512,
9110,
27868,
1976,
9048
}',
         false,false
     )

     LEFT JOIN indiv ON indiv.indiv_id = 'I'||vertex_id_target

	WHERE cost > 0
	AND cost < 3

     ORDER BY
     cost


";

if (!$link) {
    echo "error, didn't make the pg_connect()";
} else {
	$result = pg_query($link, $sql);
	if (!$result) {
	  echo "error, no result!<br>";
      print pg_last_error($link);	  
	  exit;
	}
}

	while ($row = pg_fetch_row($result)) {
		echo("I".$iid.";");
	  	echo($row[0]);
	  	echo(";");
	  	echo($row[1]);
	  	echo(";");
	  	echo($row[2]);
	  	echo(";");
		echo("<br>");
	}
}
pg_close($link);
?>